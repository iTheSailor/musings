{% extends "forecast/index.html" %}
{%load static%}
{% load forecast_extras %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col">
            <div class="d-flex">
            <h3 class="m-e-auto">{{address}}</h3>
            <div class="d-flex ms-auto">
                <a href="{% url 'forecast:index'%}" class="btn btn-md btn-primary">Back</a>
                {% if user.is_authenticated %}
                    <form action="{% url 'forecast:addLocation' %}" id="addLocation">
                        <input type="hidden" name="address" value="{{address}}">
                        <input type="hidden" name="lat" value="{{geodata.lat}}">
                        <input type="hidden" name="lon" value="{{geodata.lon}}">
                        <input type="submit" value="Add Location" class="btn btn-primary">
                    </form>
                    {% endif %}
                </div>
            </div>
            {% for day in weather %}
            <div class="card">
                <div class="card-header">
                    <h5>{{day.date | date:"M-d-Y"}}</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col m-auto">
                            {% with day.date|date:"Y-m-d" as formatted_date %}
                                {% with supplement|get:formatted_date as daily_details %}
                                    {% if daily_details %}
                                        {% for detail in daily_details %}
                                            {% if detail.isDaytime %}
                                                <p><strong>Daytime:</strong> {{ detail.detailedForecast }}</p>
                                            {% else %}
                                                <p><strong>Nighttime:</strong> {{ detail.detailedForecast }}</p>
                                            {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        <p>No detailed forecast available for this date.</p>
                                    {% endif %}
                                {% endwith %}
                            {% endwith %}
                        </div>
                        
                        <div class="col">
                            <p>Max Temp: {{ day.temperature_2m_max|floatformat:"0" }}째F</p>
                            <p>Min Temp: {{ day.temperature_2m_min|floatformat:"0" }}째F</p>
                            <p>Max Feels Like: {{ day.apparent_temperature_max|floatformat:"0" }}째F</p>
                            <p>Min Feels Like: {{ day.apparent_temperature_min|floatformat:"0" }}째F</p>
                            <p>Precipitation Sum: {{ day.precipitation_sum|floatformat:"0" }} inches</p>
                            <p>Precipitation Hours: {{ day.precipitation_hours|floatformat:"0" }}</p>
                            <p>Precipitation Probability Max: {{ day.precipitation_probability_max|floatformat:"0" }}%</p>
                            
                        </div>
                    </div>
                </div>
            {% endfor %}

        </div>
    </div>
</div>
{% endblock %}